<!DOCTYPE HTML>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <title>Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ù„Ù„Ø­Ø¬Ø§Ø¬ - ØªÙˆØ¬ÙŠÙ‡ ØµÙˆØªÙŠ</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: "Cairo", Arial, sans-serif; height: 100vh; overflow: hidden; background: #f0f2f5; }
    
    /* ØªØµÙ…ÙŠÙ… Ù…ØªØ¬Ø§ÙˆØ¨ Ù„Ù„Ø´Ø§Ø´Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø© */
    .main-container { 
      display: grid; 
      grid-template-columns: 1fr 350px; 
      height: 100vh; 
      gap: 0;
    }
    
    @media (max-width: 768px) {
      .main-container { 
        grid-template-columns: 1fr; 
        grid-template-rows: 60vh 1fr;
      }
      #sidebar { 
        order: 2; 
        max-height: 40vh;
      }
    }
    
    #map { 
      width: 100%; 
      height: 100vh; 
      z-index: 1;
    }
    
    #sidebar { 
      background: linear-gradient(145deg, #ffffff, #f8f9fa); 
      padding: 20px; 
      overflow-y: auto; 
      box-shadow: -2px 0 10px rgba(0,0,0,0.1);
      border-left: 3px solid #007bff;
    }
    
    /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© */
    #controls { 
      position: fixed; 
      top: 20px; 
      right: 20px; 
      display: flex; 
      flex-direction: column; 
      gap: 10px; 
      z-index: 1000; 
    }
    
    #controls button { 
      padding: 12px 16px; 
      border: none; 
      border-radius: 50px; 
      cursor: pointer; 
      font-weight: bold; 
      font-size: 14px; 
      box-shadow: 0 4px 15px rgba(0,0,0,0.2); 
      transition: all 0.3s;
      min-width: 140px;
    }
    
    #controls button:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.3); }
    
    #voice-btn { background: linear-gradient(45deg, #17a2b8, #20c997); color: white; }
    #navigation-btn { background: linear-gradient(45deg, #28a745, #20c997); color: white; }
    #stop-nav-btn { background: linear-gradient(45deg, #dc3545, #fd7e14); color: white; display: none; }
    
    /* Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„ØµÙˆØªÙŠ */
    #voice-navigation { 
      position: fixed; 
      top: 50%; 
      left: 50%; 
      transform: translate(-50%, -50%); 
      background: linear-gradient(135deg, #28a745, #20c997); 
      color: white; 
      padding: 25px 35px; 
      border-radius: 20px; 
      box-shadow: 0 10px 40px rgba(40, 167, 69, 0.4); 
      z-index: 1002; 
      display: none; 
      text-align: center;
      min-width: 300px;
    }
    
    #voice-navigation.active { 
      display: block; 
      animation: pulse 2s infinite; 
    }
    
    @keyframes pulse {
      0% { transform: translate(-50%, -50%) scale(1); }
      50% { transform: translate(-50%, -50%) scale(1.05); }
      100% { transform: translate(-50%, -50%) scale(1); }
    }
    
    .distance-indicator { 
      background: rgba(255,255,255,0.9); 
      color: #28a745; 
      padding: 8px 15px; 
      border-radius: 25px; 
      font-weight: bold; 
      margin-top: 15px; 
    }
    
    /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
    #search-box { 
      width: 100%; 
      padding: 12px 15px; 
      margin-bottom: 20px; 
      border: 2px solid #e9ecef; 
      border-radius: 25px; 
      font-size: 14px; 
      outline: none;
      transition: border-color 0.3s;
    }
    
    #search-box:focus { border-color: #007bff; }
    
    .category { 
      margin-bottom: 20px; 
      border-radius: 15px; 
      overflow: hidden; 
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .category-title { 
      padding: 15px 20px; 
      font-weight: bold; 
      cursor: pointer; 
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .category-title:hover { transform: translateX(5px); }
    
    .place-item { 
      padding: 12px 20px; 
      margin: 0; 
      background: white; 
      cursor: pointer; 
      transition: all 0.3s;
      border-bottom: 1px solid #f8f9fa;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .place-item:hover { 
      background: #f8f9fa; 
      transform: translateX(10px); 
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .place-item:last-child { border-bottom: none; }
    
    .place-name { font-weight: 600; color: #333; }
    .place-distance { font-size: 12px; color: #666; margin-top: 3px; }
    .distance-badge { 
      background: #007bff; 
      color: white; 
      padding: 4px 8px; 
      border-radius: 12px; 
      font-size: 11px; 
      font-weight: bold;
    }
    
    /* Ø£Ù„ÙˆØ§Ù† Ù…Ø®ØªÙ„ÙØ© Ù„ÙƒÙ„ ÙØ¦Ø© */
    .restaurants { background: linear-gradient(135deg, #ff6b6b, #ee5a24); }
    .hotels { background: linear-gradient(135deg, #4834d4, #686de0); }
    .atms { background: linear-gradient(135deg, #00d2d3, #01a3a4); }
    .pharmacies { background: linear-gradient(135deg, #ff9ff3, #f368e0); }
    .hospitals { background: linear-gradient(135deg, #ff3838, #ff6b6b); }
    .shops { background: linear-gradient(135deg, #ffb142, #ff793f); }
    .cafes { background: linear-gradient(135deg, #8c7ae6, #9c88ff); }
    .toilets { background: linear-gradient(135deg, #00d2d3, #01a3a4); }
  </style>
</head>
<body>

<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„ØµÙˆØªÙŠ -->
<div id="voice-navigation">
  <div id="nav-instruction" style="font-size: 16px; font-weight: bold;">Ø¬Ø§Ø±ÙŠ Ø¨Ø¯Ø¡ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡...</div>
  <div id="nav-distance" class="distance-indicator">Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: -- Ù…ØªØ±</div>
</div>

<!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© -->
<div id="controls">
  <button id="voice-btn">ğŸ¤ Ø¨Ø­Ø« ØµÙˆØªÙŠ</button>
  <button id="navigation-btn">ğŸ§­ Ø¨Ø¯Ø¡ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡</button>
  <button id="stop-nav-btn">â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªÙˆØ¬ÙŠÙ‡</button>
</div>

<div class="main-container">
  <div id="map"></div>
  
  <div id="sidebar">
    <input type="text" id="search-box" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø£Ù‚Ø±Ø¨ Ø§Ù„Ø®Ø¯Ù…Ø§Øª...">
    <div id="places-list"></div>
  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>

<script>
const categories = {
  "Ù…Ø·Ø§Ø¹Ù…": {
    filter: 'amenity=restaurant', 
    icon: 'ğŸ´', 
    color: '#ff6b6b',
    className: 'restaurants'
  },
  "ÙÙ†Ø§Ø¯Ù‚": {
    filter: 'tourism=hotel', 
    icon: 'ğŸ¨', 
    color: '#4834d4',
    className: 'hotels'
  },
  "Ø£Ø¬Ù‡Ø²Ø© ØµØ±Ø§Ù": {
    filter: 'amenity=atm', 
    icon: 'ğŸ§', 
    color: '#00d2d3',
    className: 'atms'
  },
  "ØµÙŠØ¯Ù„ÙŠØ§Øª": {
    filter: 'amenity=pharmacy', 
    icon: 'ğŸ’Š', 
    color: '#ff9ff3',
    className: 'pharmacies'
  },
  "Ù…Ø³ØªØ´ÙÙŠØ§Øª": {
    filter: 'amenity=hospital', 
    icon: 'ğŸ¥', 
    color: '#ff3838',
    className: 'hospitals'
  },
  "Ù…ØªØ§Ø¬Ø±": {
    filter: 'shop=*', 
    icon: 'ğŸ›ï¸', 
    color: '#ffb142',
    className: 'shops'
  },
  "Ù…Ù‚Ø§Ù‡ÙŠ": {
    filter: 'amenity=cafe', 
    icon: 'â˜•', 
    color: '#8c7ae6',
    className: 'cafes'
  },
  "Ø¯ÙˆØ±Ø§Øª Ù…ÙŠØ§Ù‡": {
    filter: 'amenity=toilets', 
    icon: 'ğŸš»', 
    color: '#00d2d3',
    className: 'toilets'
  }
};

let userLocation = [21.4225, 39.8262];
let map = L.map('map').setView(userLocation, 16);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

// Ø¥Ù†Ø´Ø§Ø¡ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù…Ù…ÙŠØ²Ø© Ù„Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ
const userIcon = L.divIcon({
  className: 'user-location-marker',
  html: `<div style="
    width: 20px; 
    height: 20px; 
    background: linear-gradient(45deg, #007bff, #0056b3); 
    border: 3px solid white; 
    border-radius: 50%; 
    box-shadow: 0 0 10px rgba(0,123,255,0.5);
    animation: userPulse 2s infinite;
  "></div>
  <style>
    @keyframes userPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }
  </style>`,
  iconSize: [20, 20],
  iconAnchor: [10, 10]
});

let userMarker = L.marker(userLocation, {icon: userIcon}).addTo(map).bindPopup("ğŸ“ Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ");
let routingControl = null;
let allPlaces = [];
let currentDestination = null;
let isNavigating = false;
let lastInstruction = '';
let watchId = null;

// Ø¥Ù†Ø´Ø§Ø¡ Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ù…Ø®ØµØµØ© Ù„ÙƒÙ„ ÙØ¦Ø©
function createCategoryIcon(category, categoryData) {
  return L.divIcon({
    className: 'category-marker',
    html: `<div style="
      width: 30px; 
      height: 30px; 
      background: ${categoryData.color}; 
      border: 2px solid white; 
      border-radius: 50%; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      font-size: 14px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    ">${categoryData.icon}</div>`,
    iconSize: [30, 30],
    iconAnchor: [15, 15]
  });
}

function startLocationTracking() {
  if (navigator.geolocation) {
    watchId = navigator.geolocation.watchPosition(
      position => {
        const newLocation = [position.coords.latitude, position.coords.longitude];
        userLocation = newLocation;
        userMarker.setLatLng(newLocation);
        
        if (isNavigating && currentDestination) {
          updateVoiceNavigation(newLocation);
        }
      },
      error => console.log('Ø®Ø·Ø£ ÙÙŠ ØªØªØ¨Ø¹ Ø§Ù„Ù…ÙˆÙ‚Ø¹:', error),
      { enableHighAccuracy: true, maximumAge: 1000, timeout: 5000 }
    );
  }
}

function updateVoiceNavigation(currentPos) {
  if (!currentDestination) return;
  
  const distanceToDestination = calcDistance(
    currentPos[0], currentPos[1], 
    currentDestination.lat, currentDestination.lon
  ) * 1000;
  
  document.getElementById('nav-distance').textContent = 
    `Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: ${Math.round(distanceToDestination)} Ù…ØªØ±`;
  
  let instruction = '';
  
  if (distanceToDestination < 10) {
    instruction = `ÙˆØµÙ„Øª Ø¥Ù„Ù‰ ${currentDestination.name}`;
    stopNavigation();
    speak(instruction);
    return;
  } else if (distanceToDestination < 50) {
    instruction = `Ø§Ù‚ØªØ±Ø¨Øª Ù…Ù† ${currentDestination.name}ØŒ Ø§Ù„Ù…Ø³Ø§ÙØ© ${Math.round(distanceToDestination)} Ù…ØªØ±`;
  } else if (distanceToDestination < 100) {
    instruction = `Ø§Ø³ØªÙ…Ø± ÙÙŠ Ù†ÙØ³ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ØŒ Ø§Ù„Ù…Ø³Ø§ÙØ© ${Math.round(distanceToDestination)} Ù…ØªØ±`;
  } else if (distanceToDestination < 200) {
    const direction = getDirection(currentPos, [currentDestination.lat, currentDestination.lon]);
    instruction = `Ø§ØªØ¬Ù‡ ${direction}ØŒ Ø§Ù„Ù…Ø³Ø§ÙØ© ${Math.round(distanceToDestination)} Ù…ØªØ±`;
  }
  
  if (instruction && instruction !== lastInstruction) {
    document.getElementById('nav-instruction').textContent = instruction;
    speak(instruction);
    lastInstruction = instruction;
  }
}

function getDirection(from, to) {
  const latDiff = to[0] - from[0];
  const lonDiff = to[1] - from[1];
  
  if (Math.abs(latDiff) > Math.abs(lonDiff)) {
    return latDiff > 0 ? 'Ø´Ù…Ø§Ù„Ø§Ù‹' : 'Ø¬Ù†ÙˆØ¨Ø§Ù‹';
  } else {
    return lonDiff > 0 ? 'Ø´Ø±Ù‚Ø§Ù‹' : 'ØºØ±Ø¨Ø§Ù‹';
  }
}

function loadPlaces() {
  const placesList = document.getElementById("places-list");
  placesList.innerHTML = '';
  allPlaces = [];
  
  Object.entries(categories).forEach(([categoryName, categoryData]) => {
    const overpassUrl = `https://overpass-api.de/api/interpreter?data=[out:json];node[${categoryData.filter}](around:2000,${userLocation[0]},${userLocation[1]});out;`;
    
    fetch(overpassUrl)
      .then(res => res.json())
      .then(data => {
        if (data.elements.length === 0) return;
        
        const placesWithDistance = data.elements.map((el, index) => {
          const placeLat = el.lat;
          const placeLon = el.lon;
          let placeName = el.tags.name || "Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…";
          
          if (categoryName === "Ø£Ø¬Ù‡Ø²Ø© ØµØ±Ø§Ù") {
            const atmNames = ["ØµØ±Ø§Ù Ø§Ù„Ø£Ù‡Ù„ÙŠ", "ØµØ±Ø§Ù Ø³Ø§Ù…Ø¨Ø§", "ØµØ±Ø§Ù Ø§Ù„Ø±ÙŠØ§Ø¶", "ØµØ±Ø§Ù Ø§Ù„Ø¬Ø²ÙŠØ±Ø©"];
            placeName = atmNames[index % atmNames.length];
          }
          
          const dist = calcDistance(userLocation[0], userLocation[1], placeLat, placeLon);
          return {
            name: placeName,
            lat: placeLat,
            lon: placeLon,
            category: categoryName,
            distance: dist
          };
        }).sort((a, b) => a.distance - b.distance).slice(0, 8);
        
        if (placesWithDistance.length === 0) return;
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø³Ù… Ø§Ù„ÙØ¦Ø©
        const categoryDiv = document.createElement('div');
        categoryDiv.className = 'category';
        
        const categoryTitle = document.createElement('div');
        categoryTitle.className = `category-title ${categoryData.className}`;
        categoryTitle.innerHTML = `${categoryData.icon} ${categoryName} (${placesWithDistance.length})`;
        categoryDiv.appendChild(categoryTitle);
        
        const placesContainer = document.createElement('div');
        placesContainer.className = 'places-container';
        
        placesWithDistance.forEach(place => {
          allPlaces.push(place);
          const distKm = place.distance.toFixed(2);
          const walkingTimeMinutes = Math.ceil(place.distance * 12);
          
          // Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø±ÙƒØ± Ù…Ø®ØµØµ Ù„Ù„Ø®Ø±ÙŠØ·Ø©
          const marker = L.marker([place.lat, place.lon], {
            icon: createCategoryIcon(categoryName, categoryData)
          }).addTo(map);
          
          marker.bindPopup(`
            <div style="text-align: center; font-family: Arial;">
              <strong>${place.name}</strong><br>
              <span style="color: ${categoryData.color};">${categoryData.icon} ${categoryName}</span><br>
              ${distKm} ÙƒÙ… - ${walkingTimeMinutes} Ø¯Ù‚ÙŠÙ‚Ø© Ù…Ø´ÙŠ
            </div>
          `);
          
          // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± Ø§Ù„Ù…ÙƒØ§Ù† ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
          const placeItem = document.createElement('div');
          placeItem.className = 'place-item';
          placeItem.onclick = () => selectDestination(place.lat, place.lon, place.name);
          
          placeItem.innerHTML = `
            <div>
              <div class="place-name">${place.name}</div>
              <div class="place-distance">ğŸš¶â€â™‚ï¸ ${walkingTimeMinutes} Ø¯Ù‚ÙŠÙ‚Ø© Ù…Ø´ÙŠ</div>
            </div>
            <div class="distance-badge">${distKm} ÙƒÙ…</div>
          `;
          
          placesContainer.appendChild(placeItem);
        });
        
        categoryDiv.appendChild(placesContainer);
        placesList.appendChild(categoryDiv);
        
        // Ø¬Ø¹Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù‚Ø§Ø¨Ù„ Ù„Ù„Ù†Ù‚Ø±
        categoryTitle.onclick = function() {
          placesContainer.style.display = placesContainer.style.display === 'none' ? 'block' : 'none';
        };
      });
  });
}

function selectDestination(lat, lon, name) {
  currentDestination = { lat, lon, name };
  map.setView([lat, lon], 18);
  
  if (routingControl) map.removeControl(routingControl);
  
  routingControl = L.Routing.control({
    waypoints: [L.latLng(userLocation[0], userLocation[1]), L.latLng(lat, lon)],
    router: L.Routing.osrmv1({
      serviceUrl: 'https://router.project-osrm.org/route/v1',
      profile: 'foot'
    }),
    lineOptions: {
      styles: [{ color: '#007bff', weight: 6, opacity: 0.8 }]
    },
    addWaypoints: false,
    draggableWaypoints: false,
    createMarker: () => null,
    show: false
  }).addTo(map);
  
  speak(`ØªÙ… Ø§Ø®ØªÙŠØ§Ø± ${name} ÙƒÙˆØ¬Ù‡Ø©. Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø¨Ø¯Ø¡ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¥Ø±Ø´Ø§Ø¯Ø§Øª ØµÙˆØªÙŠØ© Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù…Ø´ÙŠ.`);
}

function startNavigation() {
  if (!currentDestination) {
    alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ÙˆØ¬Ù‡Ø© Ø£ÙˆÙ„Ø§Ù‹');
    return;
  }
  
  isNavigating = true;
  document.getElementById('voice-navigation').classList.add('active');
  document.getElementById('navigation-btn').style.display = 'none';
  document.getElementById('stop-nav-btn').style.display = 'inline-flex';
  
  const initialDistance = calcDistance(
    userLocation[0], userLocation[1], 
    currentDestination.lat, currentDestination.lon
  ) * 1000;
  
  document.getElementById('nav-instruction').textContent = 
    `Ø¨Ø¯Ø¡ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ ${currentDestination.name}`;
  document.getElementById('nav-distance').textContent = 
    `Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: ${Math.round(initialDistance)} Ù…ØªØ±`;
  
  speak(`Ø¨Ø¯Ø¡ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ ${currentDestination.name}. Ø§ØªØ¨Ø¹ Ø§Ù„Ø®Ø· Ø§Ù„Ø£Ø²Ø±Ù‚ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©.`);
  
  startLocationTracking();
}

function stopNavigation() {
  isNavigating = false;
  document.getElementById('voice-navigation').classList.remove('active');
  document.getElementById('navigation-btn').style.display = 'inline-flex';
  document.getElementById('stop-nav-btn').style.display = 'none';
  
  if (watchId) {
    navigator.geolocation.clearWatch(watchId);
    watchId = null;
  }
  
  lastInstruction = '';
  speak('ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„ØµÙˆØªÙŠ');
}

function speak(text) {
  if ('speechSynthesis' in window) {
    speechSynthesis.cancel();
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'ar-SA';
    utterance.rate = 0.9;
    speechSynthesis.speak(utterance);
  }
}

function calcDistance(lat1, lon1, lat2, lon2) {
  const R = 6371;
  const dLat = (lat2 - lat1) * Math.PI / 180;
  const dLon = (lon2 - lon1) * Math.PI / 180;
  const a = Math.sin(dLat/2) * Math.sin(dLat/2) + 
            Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
            Math.sin(dLon/2) * Math.sin(dLon/2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
  return R * c;
}

// Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙÙŠØ©
document.getElementById('search-box').oninput = function() {
  const query = this.value.toLowerCase();
  document.querySelectorAll('.place-item').forEach(item => {
    const placeName = item.querySelector('.place-name').textContent.toLowerCase();
    if (placeName.includes(query)) {
      item.style.display = 'flex';
    } else {
      item.style.display = 'none';
    }
  });
};

// Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ØµÙˆØªÙŠ
document.getElementById('voice-btn').onclick = function() {
  if ('webkitSpeechRecognition' in window) {
    const recognition = new webkitSpeechRecognition();
    recognition.lang = 'ar-SA';
    recognition.start();
    
    recognition.onresult = function(event) {
      const searchTerm = event.results[0][0].transcript;
      document.getElementById('search-box').value = searchTerm;
      document.getElementById('search-box').oninput();
    };
  } else {
    alert('Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ØµÙˆØªÙŠ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­');
  }
};

document.getElementById('navigation-btn').onclick = startNavigation;
document.getElementById('stop-nav-btn').onclick = stopNavigation;

window.onload = function() {
  loadPlaces();
};
</script>

</body>
</html>
