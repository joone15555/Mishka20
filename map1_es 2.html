<!DOCTYPE HTML>
<html lang="ur" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <title>Ù‚Ø±ÛŒØ¨ÛŒ Ø®Ø¯Ù…Ø§Øª Ú©Ø§ Ù†Ù‚Ø´Û</title>
  <link rel="stylesheet" href="assets/css/main.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css" />
  <style>
  /* Ù†Ù‚Ø´Û Ø§ÙˆØ± ÙÛØ±Ø³Øª Ú©ÛŒ Ø§Ø³Ù¹Ø§Ø¦Ù„ */
  .container-map { display: flex; flex-direction: column; max-width: 1200px; margin: 30px auto; gap: 20px; padding: 0 20px; position: relative; }
  #map { width: 100%; height: 600px; border-radius: 16px; box-shadow: 0 4px 25px rgba(0,0,0,0.15); }
  #lists { background: linear-gradient(145deg, #c6c6d0, #a7957c); color: #333; padding: 15px; border-radius: 20px; max-height: 600px; overflow-y: auto; box-shadow: 0 10px 30px rgba(0,0,0,0.25); font-family: "Noto Nastaliq Urdu", serif; transition: 0.3s; }
  #lists details { margin-bottom: 14px; border-radius: 14px; overflow: hidden; background: rgba(255,255,255,0.15); box-shadow: 0 4px 12px rgba(0,0,0,0.1); transition: all 0.3s; border-left: 5px solid #a7957c; }
  #lists summary { font-weight: bold; font-size: 17px; padding: 12px 16px; background: linear-gradient(to right, #a7957c, #c6c6d0); color: #fff; cursor: pointer; outline: none; border-radius: 12px; }
  #lists .search-box { width: 100%; padding: 10px 14px; margin-bottom: 12px; border-radius: 12px; border: none; font-size: 15px; outline: none; }
  .list-item { display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; border-radius: 12px; margin: 4px 0; background: rgba(255,255,255,0.2); transition: background 0.3s, transform 0.2s; cursor: pointer; }
  .list-item:hover { background: rgba(255,255,255,0.3); transform: translateX(5px); }
  .item-name { flex: 1; margin: 0 8px; display: flex; align-items: center; gap: 10px; font-size: 15px; color: #333; }
  .item-dist { color: #444; font-size: 13px; background: rgba(255,255,255,0.25); padding: 3px 8px; border-radius: 10px; font-weight: bold; }
  .icon { width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; font-size: 16px; border-radius: 50%; background: #a7957c; color: white; flex-shrink: 0; }
  #controls { display: flex; flex-direction: row; justify-content: center; gap: 10px; z-index: 1000; }
  #controls button { display: flex; align-items: center; gap: 6px; padding: 10px 18px; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; font-size: 16px; transition: 0.3s; }
  #voice-btn { background-color: #17a2b8; color: #fff; }
  #voice-btn:hover { background-color: #117a8b; }
  #info-btn { background-color: #ffc107; color: #212529; }
  #info-btn:hover { background-color: #e0a800; }
  #info-popup { position: absolute; top: 20px; left: 50%; transform: translateX(-50%); background: white; padding: 16px 22px; border-radius: 16px; box-shadow: 0 6px 25px rgba(0,0,0,0.25); z-index: 1001; display: none; max-width: 320px; font-family: "Noto Nastaliq Urdu", serif; transition: 0.3s; }
  #info-popup button { margin-top: 10px; padding: 6px 12px; font-size: 13px; border: none; border-radius: 10px; background: #4facfe; color: white; cursor: pointer; }
  </style>
</head>
<body class="is-preload homepage">

<!-- Intro Screen -->
<div id="intro-screen" style="position: fixed; top:0; left:0; width:100%; height:100%; background:#ffffff; color:#000; display:flex; justify-content:center; align-items:center; flex-direction:column; font-family:sans-serif; z-index:9999;">
  <img src="loading-image.png" alt="Ù„ÙˆÚˆ ÛÙˆØ±ÛØ§ ÛÛ’" style="margin-bottom:20px; max-width:200px;">
  <p style="font-size:18px;">Ù„ÙˆÚˆ ÛÙˆ Ø±ÛØ§ ÛÛ’...</p>
</div>

<!-- Header -->
<div id="header-wrapper">
  <header id="header" class="container" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; direction: rtl;">
    <div id="logo" style="order: 1;">
      <a href="index_es 2.html">
        <img src="loading-image.png" alt="Ø³Ø§Ø¦Ù¹ Ú©Ø§ Ù„ÙˆÚ¯Ùˆ" style="max-width:150px; height:auto;">
      </a>
    </div>
    <nav style="order: 2; display: flex; align-items: center;">
      <ul style="display:flex; gap:20px; list-style:none; margin:0; padding:0; align-items:center; position:relative;">
        <li><a href="index_es 2.html" style="font-weight:bold; text-decoration:none; color:#444; padding:8px 16px; border-radius:8px; transition:0.3s;"
          onmouseover="this.style.backgroundColor='#f0f0f0'; this.style.color='#000';"
          onmouseout="this.style.backgroundColor='transparent'; this.style.color='#444';"
        >ÛÙˆÙ…</a></li>
        <li><a href="card_es 2.html" style="font-weight:bold; text-decoration:none; color:#444; padding:8px 16px; border-radius:8px; transition:0.3s;"
          onmouseover="this.style.backgroundColor='#f0f0f0'; this.style.color='#000';"
          onmouseout="this.style.backgroundColor='transparent'; this.style.color='#444';"
        >Ù…Ø´Ú©Ø§Ø© Ú©Ø§Ø±Úˆ</a></li>

        <!-- Language Dropdown -->
        <li style="position: relative;">
          <button onclick="toggleLanguageMenu()" style="background:none; border:none; font-size:24px; cursor:pointer; padding:8px;" title="Ø²Ø¨Ø§Ù† ØªØ¨Ø¯ÛŒÙ„ Ú©Ø±ÛŒÚº">ğŸŒ</button>
          <ul id="language-menu" style="display:none; position:absolute; top:40px; left:0; background-color:#fff; border:1px solid #ddd; border-radius:8px; box-shadow:0 4px 8px rgba(0,0,0,0.1); list-style:none; padding:10px 0; margin:0; min-width:160px; z-index:1000;">
            <li><a href="map1.html" style="display:flex; align-items:center; padding:8px 16px; text-decoration:none; color:#444; font-weight:bold; transition: background 0.3s;" onmouseover="this.style.backgroundColor='#f0f0f0';" onmouseout="this.style.backgroundColor='transparent';">ğŸ‡¸ğŸ‡¦ &nbsp; Ø¹Ø±Ø¨ÛŒ</a></li>
            <li><a href="map1_en.html" style="display:flex; align-items:center; padding:8px 16px; text-decoration:none; color:#444; font-weight:bold; transition: background 0.3s;" onmouseover="this.style.backgroundColor='#f0f0f0';" onmouseout="this.style.backgroundColor='transparent';">ğŸ‡ºğŸ‡¸ &nbsp; English</a></li>
            <li><a href="map1_es 2.html" style="display:flex; align-items:center; padding:8px 16px; text-decoration:none; color:#444; font-weight:bold; transition: background 0.3s;" onmouseover="this.style.backgroundColor='#f0f0f0';" onmouseout="this.style.backgroundColor='transparent';">ğŸ‡µğŸ‡° &nbsp; Ø§Ø±Ø¯Ùˆ</a></li>
          </ul>
        </li>
      </ul>
    </nav>
  </header>
</div>

<!-- Ù†Ù‚Ø´Û Ø§ÙˆØ± Ù…ÙˆØ§Ø¯ -->
<div class="container-map">
  <div id="map"></div>
  <div id="controls">
    <button id="voice-btn">ğŸ¤ Ø¨ÙˆÙ„ÛŒÚº</button>
    <button id="info-btn">â„¹ï¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</button>
  </div>
  <div id="lists">
    <input type="text" id="search-box" class="search-box" placeholder="Ú©Ø³ÛŒ Ø¨Ú¾ÛŒ Ø¬Ú¯Û Ú©Ø§ Ù†Ø§Ù… ÛŒÛØ§Úº ØªÙ„Ø§Ø´ Ú©Ø±ÛŒÚº..." oninput="filterList()">
  </div>
  <div id="info-popup">
    <strong id="info-title"></strong>
    <p id="info-desc" style="margin-top: 8px; font-size: 14px;"></p>
    <button onclick="document.getElementById('info-popup').style.display='none'">Ø¨Ù†Ø¯ Ú©Ø±ÛŒÚº</button>
  </div>
</div>

<!-- Footer -->
<div id="footer-wrapper">
  <footer id="footer" class="container">
    <div class="row">
      <div class="col-3 col-6-medium col-12-small">
        <section class="widget contact last">
          <h3>ÛÙ… Ø³Û’ Ø±Ø§Ø¨Ø·Û Ú©Ø±ÛŒÚº</h3>
          <ul>
            <li><a href="#" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
            <li><a href="#" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
            <li><a href="#" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
            <li><a href="#" class="icon brands fa-dribbble"><span class="label">Dribbble</span></a></li>
            <li><a href="#" class="icon brands fa-pinterest"><span class="label">Pinterest</span></a></li>
          </ul>
          <p>1234 Fictional Road<br />
          Nashville, TN 00000<br />
          (800) 555-0000</p>
        </section>
      </div>
    </div>
    <div class="row">
      <div class="col-12">
        <div id="copyright">
          <ul class="menu">
            <li>&copy; Ø¬Ù…Ù„Û Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸ ÛÛŒÚº</li><li>ÚˆÛŒØ²Ø§Ø¦Ù†: <a href="http://html5up.net">HTML5 UP</a></li>
          </ul>
        </div>
      </div>
    </div>
  </footer>
</div>

<!-- Scripts -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.6.2/fuse.min.js"></script>

<script>
// Ù†ÙØ³ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚ Ù…Ø¹ Ø§Ù„ÙÙ„ØªØ±Ø©
const categories = {
  "Ø±ÛŒØ³Ù¹ÙˆØ±Ù†Ù¹Ø³": {filter:'amenity=restaurant', icon:'ğŸ´'},
  "ÛÙˆÙ¹Ù„Ø²": {filter:'tourism=hotel', icon:'ğŸ¨'},
  "Ø§Û’ Ù¹ÛŒ Ø§ÛŒÙ…": {filter:'amenity=atm', icon:'ğŸ§'},
  "ÙØ§Ø±Ù…ÛŒØ³ÛŒ": {filter:'amenity=pharmacy', icon:'ğŸ’Š'},
  "ÛØ³Ù¾ØªØ§Ù„": {filter:'amenity=hospital', icon:'ğŸ¥'},
  "Ø¯ÙˆÚ©Ø§Ù†ÛŒÚº": {filter:'shop=*', icon:'ğŸ›ï¸'},
  "Ú©Ø§ÙÛŒ Ø´Ø§Ù¾": {filter:'amenity=cafe', icon:'â˜•'},
  "Ù¹ÙˆØ§Ø¦Ù„Ù¹Ø³": {filter:'amenity=toilets', icon:'ğŸš»'}
};

const categoryDescriptions = {
  "Ø±ÛŒØ³Ù¹ÙˆØ±Ù†Ù¹Ø³": "Ø±ÛŒØ³Ù¹ÙˆØ±Ù†Ù¹Ø³: Ù…Ø®ØªÙ„Ù Ù‚Ø³Ù… Ú©Û’ Ú©Ú¾Ø§Ù†Û’ ÙØ±Ø§ÛÙ… Ú©Ø±ØªÛ’ ÛÛŒÚºÛ”",
  "ÛÙˆÙ¹Ù„Ø²": "ÛÙˆÙ¹Ù„Ø²: Ø¢Ø±Ø§Ù… Ø¯Û Ø±ÛØ§Ø¦Ø´ Ø§ÙˆØ± Ø¨ÛØªØ±ÛŒÙ† Ø³ÛÙˆÙ„ÛŒØ§ØªÛ”",
  "Ø§Û’ Ù¹ÛŒ Ø§ÛŒÙ…": "Ø§Û’ Ù¹ÛŒ Ø§ÛŒÙ…: Ø¢Ø³Ø§Ù†ÛŒ Ø³Û’ Ø±Ù‚Ù… Ù†Ú©Ø§Ù„ÛŒÚº ÛŒØ§ Ù…Ù†ØªÙ‚Ù„ Ú©Ø±ÛŒÚºÛ”",
  "ÙØ§Ø±Ù…ÛŒØ³ÛŒ": "ÙØ§Ø±Ù…ÛŒØ³ÛŒ: Ø§Ø¯ÙˆÛŒØ§Øª Ø§ÙˆØ± ØµØ­Øª Ú©ÛŒ Ù…ØµÙ†ÙˆØ¹Ø§Øª Ø¯Ø³ØªÛŒØ§Ø¨ ÛÛŒÚºÛ”",
  "ÛØ³Ù¾ØªØ§Ù„": "ÛØ³Ù¾ØªØ§Ù„: ÛÙ†Ú¯Ø§Ù…ÛŒ Ø§ÙˆØ± Ù…Ø¹ÛŒØ§Ø±ÛŒ Ø·Ø¨ÛŒ Ø®Ø¯Ù…Ø§ØªÛ”",
  "Ø¯ÙˆÚ©Ø§Ù†ÛŒÚº": "Ø¯ÙˆÚ©Ø§Ù†ÛŒÚº: Ú©Ù¾Ú‘Û’ Ø§ÙˆØ± Ø¯ÛŒÚ¯Ø± Ø§Ø´ÛŒØ§Ø¡ Ú©ÛŒ Ù…Ø®ØªÙ„Ù Ø§Ù‚Ø³Ø§Ù…Û”",
  "Ú©Ø§ÙÛŒ Ø´Ø§Ù¾": "Ú©Ø§ÙÛŒ Ø´Ø§Ù¾: Ø¢Ø±Ø§Ù… Ø¯Û Ø¬Ú¯Û Ø§ÙˆØ± Ú©Ø§ÙÛŒ Ú©Ø§ Ù„Ø·ÙÛ”",
  "Ù¹ÙˆØ§Ø¦Ù„Ù¹Ø³": "Ù¹ÙˆØ§Ø¦Ù„Ù¹Ø³: Ø¹ÙˆØ§Ù…ÛŒ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Û’ Ù„ÛŒÛ’ Ø¯Ø³ØªÛŒØ§Ø¨Û”",
  "Unknown": "ØªÙØµÛŒÙ„ Ø¯Ø³ØªÛŒØ§Ø¨ Ù†ÛÛŒÚºÛ”"
};

let userLocation = [21.4225,39.8262];
let lang = "ur-PK";
let lastSelectedPlace = null;
const map = L.map('map').setView(userLocation, 16);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution:'&copy; OpenStreetMap contributors' }).addTo(map);
let userMarker = L.marker(userLocation).addTo(map).bindPopup("Ø¢Ù¾ Ú©Ø§ Ù…ÙˆØ¬ÙˆØ¯Û Ù…Ù‚Ø§Ù…").openPopup();
let routingControl = null;
let allPlaces = [];
let fuse = null;

navigator.geolocation.getCurrentPosition(pos => {
  userLocation = [pos.coords.latitude, pos.coords.longitude];
  userMarker.setLatLng(userLocation).bindPopup("Ø¢Ù¾ Ú©Ø§ Ù…ÙˆØ¬ÙˆØ¯Û Ù…Ù‚Ø§Ù…");
}, ()=>{});

function loadPlaces(lat, lon){
  const listsDiv = document.getElementById("lists");
  listsDiv.innerHTML = '<input type="text" id="search-box" class="search-box" placeholder="Ú©Ø³ÛŒ Ø¨Ú¾ÛŒ Ø¬Ú¯Û Ú©Ø§ Ù†Ø§Ù… ÛŒÛØ§Úº ØªÙ„Ø§Ø´ Ú©Ø±ÛŒÚº..." oninput="filterList()">';
  allPlaces = [];
  for(const [name, cat] of Object.entries(categories)){
    const overpassUrl = `https://overpass-api.de/api/interpreter?data=[out:json];node[${cat.filter}](around:1500,${lat},${lon});out;`;
    fetch(overpassUrl)
      .then(res=>res.json())
      .then(data=>{
        let html = `<details open><summary>${cat.icon} ${name} (<span class="cat-count">${data.elements.length}</span>)</summary>`;
        data.elements.forEach((el,index)=>{
          const placeLat = el.lat;
          const placeLon = el.lon;
          let placeName = el.tags.name || "Ù†Ø§Ù… Ø¯Ø³ØªÛŒØ§Ø¨ Ù†ÛÛŒÚº";
          allPlaces.push({name:placeName,lat:placeLat,lon:placeLon,category:name});
          const dist = calcDistance(userLocation[0],userLocation[1],placeLat,placeLon).toFixed(2);
          L.marker([placeLat, placeLon]).addTo(map).bindPopup(`${placeName}<br>${dist} Ú©Ù„ÙˆÙ…ÛŒÙ¹Ø±`);
          html += `<div class="list-item" onclick="focusPlace(${placeLat},${placeLon},'${placeName.replace(/'/g, "&#39;")}','${name}')"><span class="item-name"><span class="icon">${cat.icon}</span>${placeName}</span><span class="item-dist">${dist} Ú©Ù„ÙˆÙ…ÛŒÙ¹Ø±</span></div>`;
        });
        html += "</details>";
        listsDiv.innerHTML += html;
        fuse = new Fuse(allPlaces, {keys:["name"], threshold:0.4});
      });
  }
}

function focusPlace(lat, lon, name, category){
  map.setView([lat, lon],18);
  L.popup().setLatLng([lat,lon]).setContent(name).openOn(map);
  lastSelectedPlace = {name, lat, lon, category};
  if(routingControl) map.removeControl(routingControl);
  routingControl = L.Routing.control({
    waypoints:[L.latLng(userLocation[0],userLocation[1]),L.latLng(lat,lon)],
    lineOptions:{styles:[{color:'blue',opacity:0.6,weight:5}]},
    addWaypoints:false,
    draggableWaypoints:false,
    routeWhileDragging:false,
    showAlternatives:false,
    createMarker:()=>null
  }).addTo(map);
  describeRoute(userLocation,[lat,lon],name);
}

function describeRoute(start,end,placeName){
  const latDiff=end[0]-start[0];
  const lonDiff=end[1]-start[1];
  let text = `Ø§Ù¾Ù†Û’ Ù…ÙˆØ¬ÙˆØ¯Û Ù…Ù‚Ø§Ù… Ø³Û’ ${placeName} Ú©ÛŒ Ø·Ø±Ù Ø¬Ø§Ø¦ÛŒÚºÛ” `;
  text+=Math.abs(latDiff)>Math.abs(lonDiff)?(latDiff>0?"Ø´Ù…Ø§Ù„ Ú©ÛŒ Ø·Ø±Ù Ø¬Ø§Ø¦ÛŒÚºÛ” ":"Ø¬Ù†ÙˆØ¨ Ú©ÛŒ Ø·Ø±Ù Ø¬Ø§Ø¦ÛŒÚºÛ” "):(lonDiff>0?"Ù…Ø´Ø±Ù‚ Ú©ÛŒ Ø·Ø±Ù Ø¬Ø§Ø¦ÛŒÚºÛ” ":"Ù…ØºØ±Ø¨ Ú©ÛŒ Ø·Ø±Ù Ø¬Ø§Ø¦ÛŒÚºÛ” ");
  speak(text);
}

function speak(text){
  speechSynthesis.cancel();
  const utterance = new SpeechSynthesisUtterance(text);
  utterance.lang = lang;
  speechSynthesis.speak(utterance);
}

function calcDistance(lat1,lon1,lat2,lon2){
  const R=6371;
  const dLat=(lat2-lat1)*Math.PI/180;
  const dLon=(lon2-lon1)*Math.PI/180;
  const a=Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;
  const c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
  return R*c;
}

document.getElementById("voice-btn").addEventListener("click",()=>{
  if(!('webkitSpeechRecognition' in window || 'SpeechRecognition' in window)){
    alert("Ø¢Ù¾ Ú©Û’ Ø¨Ø±Ø§Ø¤Ø²Ø± Ù…ÛŒÚº Ø¢ÙˆØ§Ø² Ø³Û’ Ù¾ÛÚ†Ø§Ù† Ú©ÛŒ Ø³ÛÙˆÙ„Øª Ø¯Ø³ØªÛŒØ§Ø¨ Ù†ÛÛŒÚº");
    return;
  }
  const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang = lang;
  recognition.start();
  recognition.onresult = function(event){
    const transcript = event.results[0][0].transcript;
    if(fuse){
      const results = fuse.search(transcript);
      if(results.length>0){
        const match = results[0].item;
        focusPlace(match.lat, match.lon, match.name, match.category);
      } else {
        speak("ÛŒÛ Ø¬Ú¯Û Ù…Ø¹Ù„ÙˆÙ… Ù†ÛÛŒÚºØŒ Ø¯ÙˆØ¨Ø§Ø±Û Ú©ÙˆØ´Ø´ Ú©Ø±ÛŒÚºÛ”");
      }
    }
  }
});

document.getElementById("info-btn").addEventListener("click",()=>{
  const popup = document.getElementById("info-popup");
  if(lastSelectedPlace){
    document.getElementById("info-title").innerText = lastSelectedPlace.name;
    document.getElementById("info-desc").innerText = categoryDescriptions[lastSelectedPlace.category] || categoryDescriptions["Unknown"];
    popup.style.display = "block";
  } else {
    alert("Ø¨Ø±Ø§Û Ú©Ø±Ù… Ù¾ÛÙ„Û’ Ú©Ø³ÛŒ Ø¬Ú¯Û Ú©Ùˆ Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº");
  }
});

function toggleLanguageMenu() {
  const menu = document.getElementById('language-menu');
  if (menu.style.display === 'block') { menu.style.display = 'none'; } else { menu.style.display = 'block'; }
}

document.addEventListener('click', function (e) {
  const menu = document.getElementById('language-menu');
  const button = e.target.closest('button');
  if (!e.target.closest('#language-menu') && (!button || button.innerText !== 'ğŸŒ')) { menu.style.display = 'none'; }
});

function filterList(){
  const query = document.getElementById("search-box").value.toLowerCase();
  document.querySelectorAll(".list-item").forEach(item=>{
    const name = item.querySelector(".item-name").innerText.toLowerCase();
    item.style.display = name.includes(query) ? "flex" : "none";
  });
}

window.addEventListener("load",()=>{
  setTimeout(()=>{document.getElementById("intro-screen").style.display="none";},1500);
  loadPlaces(userLocation[0],userLocation[1]);
});
</script>
</body>
</html>
