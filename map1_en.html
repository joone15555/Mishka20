<!DOCTYPE HTML>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<title>Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù‚Ø±ÙŠØ¨Ø©</title>
<link rel="stylesheet" href="assets/css/main.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css" />
<style>
/* ==== Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª ÙƒÙ…Ø§ Ù‡ÙŠ ØªÙ…Ø§Ù…Ø§Ù‹ ==== */
.container-map { display: flex; flex-direction: column; max-width: 1200px; margin: 30px auto; gap: 20px; padding: 0 20px; position: relative; }
#map { width: 100%; height: 600px; border-radius: 16px; box-shadow: 0 4px 25px rgba(0,0,0,0.15); }
#lists { background: linear-gradient(145deg, #c6c6d0, #a7957c); color: #333; padding: 15px; border-radius: 20px; max-height: 600px; overflow-y: auto; box-shadow: 0 10px 30px rgba(0,0,0,0.25); font-family: "Cairo", sans-serif; transition: 0.3s; }
#lists details { margin-bottom: 14px; border-radius: 14px; overflow: hidden; background: rgba(255,255,255,0.15); box-shadow: 0 4px 12px rgba(0,0,0,0.1); transition: all 0.3s; border-left: 5px solid #a7957c; }
#lists details:hover { box-shadow: 0 6px 20px rgba(0,0,0,0.2); transform: translateY(-2px); }
#lists summary { font-weight: bold; font-size: 17px; padding: 12px 16px; background: linear-gradient(to right, #a7957c, #c6c6d0); color: #fff; cursor: pointer; outline: none; border-radius: 12px; }
.list-item { display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; border-radius: 12px; margin: 4px 0; background: rgba(255,255,255,0.2); transition: background 0.3s, transform 0.2s; cursor: pointer; }
.list-item:hover { background: rgba(255,255,255,0.3); transform: translateX(5px); }
.item-name { flex: 1; margin: 0 8px; display: flex; align-items: center; gap: 10px; font-size: 15px; color: #333; }
.item-dist { color: #444; font-size: 13px; background: rgba(255,255,255,0.25); padding: 3px 8px; border-radius: 10px; font-weight: bold; }
.icon { width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; font-size: 16px; border-radius: 50%; background: #a7957c; color: white; flex-shrink: 0; }
#controls { display: flex; flex-direction: row; justify-content: center; gap: 10px; z-index: 1000; }
#controls button { display: flex; align-items: center; gap: 6px; padding: 10px 18px; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; font-size: 16px; transition: 0.3s; }
#voice-btn { background-color: #17a2b8; color: #fff; }
#voice-btn:hover { background-color: #117a8b; }
#info-btn { background-color: #ffc107; color: #212529; }
#info-btn:hover { background-color: #e0a800; }
#info-popup { position: absolute; top: 20px; left: 50%; transform: translateX(-50%); background: white; padding: 16px 22px; border-radius: 16px; box-shadow: 0 6px 25px rgba(0,0,0,0.25); z-index: 1001; display: none; max-width: 320px; font-family: Cairo, sans-serif; transition: 0.3s; }
#info-popup button { margin-top: 10px; padding: 6px 12px; font-size: 13px; border: none; border-radius: 10px; background: #4facfe; color: white; cursor: pointer; }
</style>
</head>
<body class="is-preload homepage">
<div id="intro-screen" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #ffffff; color: #000; display: flex; justify-content: center; align-items: center; flex-direction: column; font-family: sans-serif; z-index: 9999;">
  <img src="loading-image.png" alt="ØªØ­Ù…ÙŠÙ„" style="margin-bottom: 20px; max-width: 200px;">
  <p style="font-size: 18px;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
</div>

<div id="header-wrapper">
  <header id="header" class="container" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; direction: rtl; padding: 10px 20px;">
    <div id="logo" style="order: 1;">
      <a href="index.html"><img src="loading-image.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹" style="max-width: 150px; height: auto;"></a>
    </div>
    <nav style="order: 2; display: flex; align-items: center; gap: 15px;">
      <ul style="display: flex; gap: 15px; list-style: none; margin: 0; padding: 0; align-items: center; position: relative;">
        <li><a href="index.html" class="nav-link">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
        <li><a href="futcher work.html" class="nav-link">Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©</a></li>
        <li><a href="card.html" class="nav-link">Ø¨Ø·Ø§Ù‚Ø© Ù…Ø´ÙƒØ§Ø©</a></li>
        <li style="position: relative;">
          <button onclick="toggleLanguageMenu()" style="background: none; border: none; font-size: 24px; cursor: pointer; padding: 8px;" title="ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ©">ğŸŒ</button>
          <ul id="language-menu" style="display: none; position: absolute; top: 40px; left: 0; background-color: #fff; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); list-style: none; padding: 10px 0; margin: 0; min-width: 160px; z-index: 1000;">
            <li><a href="index.html" class="lang-link">ğŸ‡¸ğŸ‡¦ &nbsp; Arabic</a></li>
            <li><a href="index_en.html" class="lang-link">ğŸ‡ºğŸ‡¸ &nbsp; English</a></li>
            <li><a href="index_es 2.html" class="lang-link">ğŸ‡µğŸ‡° &nbsp; Ø§Ø±Ø¯Ùˆ</a></li>
          </ul>
        </li>
      </ul>
    </nav>
  </header>
</div>

<style>
.nav-link { font-weight: bold; text-decoration: none; color: #444; padding: 8px 16px; border-radius: 8px; transition: background-color 0.3s, color 0.3s; }
.nav-link:hover { background-color: #f0f0f0; color: #000; }
.lang-link { display: flex; align-items: center; padding: 8px 16px; text-decoration: none; color: #444; font-weight: bold; transition: background 0.3s; }
.lang-link:hover { background-color: #f0f0f0; }
@media screen and (max-width: 768px) {
  #language-menu { position: fixed !important; top: 0; left: 0; width: 100%; min-width: unset; border-radius: 0; box-shadow: none; padding: 20px 0; background-color: #fff; }
  #language-menu .lang-link { justify-content: flex-start; padding: 15px 20px; font-size: 20px; }
}
</style>

<script>
function toggleLanguageMenu(){
  const menu=document.getElementById('language-menu');
  menu.style.display=(menu.style.display==='block')?'none':'block';
}
document.addEventListener('click', function(e){
  const menu=document.getElementById('language-menu');
  const button=e.target.closest('button');
  if(!e.target.closest('#language-menu') && (!button || button.innerText!=='ğŸŒ')){
    menu.style.display='none';
  }
});
</script>

<div class="container-map">
  <div id="map"></div>
  <div id="controls">
    <button id="voice-btn">ğŸ¤ Ø§Ù„ØªØ­Ø¯Ø«</button>
    <button id="info-btn">â„¹ï¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</button>
  </div>
  <div style="margin-bottom: 12px;">
    <input type="text" id="search-input" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…ÙƒØ§Ù†..." style="width: 100%; padding: 10px 14px; border-radius: 12px; border: 1px solid #ccc; font-size: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); outline: none; transition: 0.3s;">
  </div>
  <div id="lists"></div>
  <div id="info-popup">
    <strong id="info-title"></strong>
    <p id="info-desc" style="margin-top: 8px; font-size: 14px;"></p>
    <button onclick="document.getElementById('info-popup').style.display='none'">Ø¥ØºÙ„Ø§Ù‚</button>
  </div>
</div>

<footer id="footer" class="container" style="margin-top:30px;">
  <p style="text-align:center;">&copy; Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
</footer>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>

<script>
const categories = {
"Ù…Ø·Ø§Ø¹Ù…": {filter:'amenity=restaurant', icon:'ğŸ´'},
"ÙÙ†Ø§Ø¯Ù‚": {filter:'tourism=hotel', icon:'ğŸ¨'},
"Ø£Ø¬Ù‡Ø²Ø© ØµØ±Ø§Ù Ø¢Ù„ÙŠ": {filter:'amenity=atm', icon:'ğŸ§'},
"ØµÙŠØ¯Ù„ÙŠØ§Øª": {filter:'amenity=pharmacy', icon:'ğŸ’Š'},
"Ù…Ø³ØªØ´ÙÙŠØ§Øª": {filter:'amenity=hospital', icon:'ğŸ¥'},
"Ù…Ø­Ù„Ø§Øª": {filter:'shop=*', icon:'ğŸ›ï¸'},
"Ù…Ù‚Ø§Ù‡ÙŠ": {filter:'amenity=cafe', icon:'â˜•'},
"Ø¯ÙˆØ±Ø§Øª Ù…ÙŠØ§Ù‡": {filter:'amenity=toilets', icon:'ğŸš»'}
};
const categoryDescriptions = {
"Ù…Ø·Ø§Ø¹Ù…":"Ù…Ø·Ø§Ø¹Ù…: ØªÙˆÙØ± Ø£Ø·Ø¹Ù…Ø© Ù…ØªÙ†ÙˆØ¹Ø© Ù…Ù† Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©.",
"ÙÙ†Ø§Ø¯Ù‚":"ÙÙ†Ø§Ø¯Ù‚: Ø¥Ù‚Ø§Ù…Ø© Ù…Ø±ÙŠØ­Ø© Ù…Ø¹ Ø®Ø¯Ù…Ø§Øª Ù…Ù…ÙŠØ²Ø©.",
"Ø£Ø¬Ù‡Ø²Ø© ØµØ±Ø§Ù Ø¢Ù„ÙŠ":"Ø£Ø¬Ù‡Ø²Ø© ØµØ±Ø§Ù Ø¢Ù„ÙŠ: Ø³Ø­Ø¨ ÙˆØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ Ø¨Ø³Ù‡ÙˆÙ„Ø©.",
"ØµÙŠØ¯Ù„ÙŠØ§Øª":"ØµÙŠØ¯Ù„ÙŠØ§Øª: Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¯ÙˆÙŠØ© ÙˆØ§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØµØ­ÙŠØ©.",
"Ù…Ø³ØªØ´ÙÙŠØ§Øª":"Ù…Ø³ØªØ´ÙÙŠØ§Øª: Ø®Ø¯Ù…Ø§Øª Ø·Ø¨ÙŠØ© Ø¹Ø§Ø¬Ù„Ø© ÙˆÙ…Ø³ØªÙ…Ø±Ø©.",
"Ù…Ø­Ù„Ø§Øª":"Ù…Ø­Ù„Ø§Øª: Ù…Ù„Ø§Ø¨Ø³ ÙˆØ¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª Ù…ØªÙ†ÙˆØ¹Ø©.",
"Ù…Ù‚Ø§Ù‡ÙŠ":"Ù…Ù‚Ø§Ù‡ÙŠ: Ù…ÙƒØ§Ù† Ù„Ù„Ø§Ø³ØªØ±Ø®Ø§Ø¡ ÙˆØªÙ†Ø§ÙˆÙ„ Ø§Ù„Ù‚Ù‡ÙˆØ©.",
"Ø¯ÙˆØ±Ø§Øª Ù…ÙŠØ§Ù‡":"Ø¯ÙˆØ±Ø§Øª Ù…ÙŠØ§Ù‡: Ù…ØªÙˆÙØ±Ø© Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¹Ø§Ù….",
"ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ":"ÙˆØµÙ ØºÙŠØ± Ù…ØªÙˆÙØ±."
};

let userLocation=[21.4225,39.8262];
let lang="ar-SA";
let lastSelectedPlace=null;
const map=L.map('map').setView(userLocation,16);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'&copy; OpenStreetMap contributors'}).addTo(map);
let userMarker=L.marker(userLocation).addTo(map).bindPopup("Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ").openPopup();
let routingControl=null;
let allPlaces=[];

navigator.geolocation.getCurrentPosition(pos=>{
  userLocation=[pos.coords.latitude,pos.coords.longitude];
  userMarker.setLatLng(userLocation).bindPopup("Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ");
},()=>{});

function loadPlaces(lat,lon){
  const listsDiv=document.getElementById("lists");
  listsDiv.innerHTML="";
  allPlaces=[];
  for(const [name,cat] of Object.entries(categories)){
    const overpassUrl=`https://overpass-api.de/api/interpreter?data=[out:json];node[${cat.filter}](around:1500,${lat},${lon});out;`;
    fetch(overpassUrl)
      .then(res=>res.json())
      .then(data=>{
        let html=`<details open><summary>${cat.icon} ${name} (<span class="cat-count">${data.elements.length}</span>)</summary>`;
        data.elements.forEach((el,index)=>{
          const placeLat=el.lat;
          const placeLon=el.lon;
          let placeName=el.tags.name||"ØºÙŠØ± Ù…Ø³Ù…Ù‰";
          if(name==="Ø£Ø¬Ù‡Ø²Ø© ØµØ±Ø§Ù Ø¢Ù„ÙŠ"){
            const atmNames=["Ø§Ù„Ø£Ù‡Ù„ÙŠ ATM 1","Ø§Ù„Ø£Ù‡Ù„ÙŠ ATM 2","Ø³Ø§Ù…Ø¨Ø§ ATM 1","Ø³Ø§Ù…Ø¨Ø§ ATM 2","Ø§Ù„Ø±ÙŠØ§Ø¶ ATM 1","Ø§Ù„Ø±ÙŠØ§Ø¶ ATM 2","Ø§Ù„Ø¬Ø²ÙŠØ±Ø© ATM","Ø§Ù„Ø¥Ù†Ù…Ø§Ø¡ ATM"];
            placeName=atmNames[index % atmNames.length];
          }
          allPlaces.push({name:placeName,lat:placeLat,lon:placeLon,category:name});
          const dist=calcDistance(userLocation[0],userLocation[1],placeLat,placeLon).toFixed(2);
          L.marker([placeLat,placeLon]).addTo(map).bindPopup(`${placeName}<br>${dist} ÙƒÙ…`);
          html+=`<div class="list-item" onclick="focusPlace(${placeLat},${placeLon},'${placeName.replace(/'/g,"&#39;")}','${name}')"><span class="item-name"><span class="icon">${cat.icon}</span>${placeName}</span><span class="item-dist">${dist} ÙƒÙ…</span></div>`;
        });
        html+="</details>";
        listsDiv.innerHTML+=html;
      });
  }
}

function focusPlace(lat,lon,name,category){
  map.setView([lat,lon],18);
  L.popup().setLatLng([lat,lon]).setContent(name).openOn(map);
  lastSelectedPlace={name,lat,lon,category};
  if(routingControl) map.removeControl(routingControl);
  routingControl=L.Routing.control({
    waypoints:[L.latLng(userLocation[0],userLocation[1]),L.latLng(lat,lon)],
    lineOptions:{styles:[{color:'blue',opacity:0.6,weight:5}]},
    addWaypoints:false, draggableWaypoints:false, routeWhileDragging:false, showAlternatives:false, createMarker:()=>null
  }).addTo(map);
  describeRoute(userLocation,[lat,lon],name);
}

function describeRoute(start,end,placeName){
  const latDiff=end[0]-start[0];
  const lonDiff=end[1]-start[1];
  let text="";
  if(lang==="ar-SA"){ text=`Ø§Ø°Ù‡Ø¨ Ù…Ù† Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¥Ù„Ù‰ ${placeName}. `; text+=Math.abs(latDiff)>Math.abs(lonDiff)?(latDiff>0?"Ø§ØªØ¬Ù‡ Ø´Ù…Ø§Ù„Ù‹Ø§. ":"Ø§ØªØ¬Ù‡ Ø¬Ù†ÙˆØ¨Ù‹Ø§. "):(lonDiff>0?"Ø§ØªØ¬Ù‡ Ø´Ø±Ù‚Ù‹Ø§. ":"Ø§ØªØ¬Ù‡ ØºØ±Ø¨Ù‹Ø§. "); }
  else if(lang==="en-US"){ text=`Go from your current location to ${placeName}. `; text+=Math.abs(latDiff)>Math.abs(lonDiff)?(latDiff>0?"Head north. ":"Head south. "):(lonDiff>0?"Head east. ":"Head west. "); }
  else if(lang==="ur-PK"){ text=`Ø§Ù¾Ù†Û’ Ù…ÙˆØ¬ÙˆØ¯Û Ù…Ù‚Ø§Ù… Ø³Û’ ${placeName} Ø¬Ø§Ø¦ÛŒÚºÛ” `; text+=Math.abs(latDiff)>Math.abs(lonDiff)?(latDiff>0?"Ø´Ù…Ø§Ù„ Ú©ÛŒ Ø·Ø±Ù Ø¬Ø§Ø¦ÛŒÚºÛ” ":"Ø¬Ù†ÙˆØ¨ Ú©ÛŒ Ø·Ø±Ù Ø¬Ø§Ø¦ÛŒÚºÛ” "):(lonDiff>0?"Ù…Ø´Ø±Ù‚ Ú©ÛŒ Ø·Ø±Ù Ø¬Ø§Ø¦ÛŒÚºÛ” ":"Ù…ØºØ±Ø¨ Ú©ÛŒ Ø·Ø±Ù Ø¬Ø§Ø¦ÛŒÚºÛ” "); }
  speak(text);
}

function speak(text){ speechSynthesis.cancel(); const utterance=new SpeechSynthesisUtterance(text); utterance.lang=lang; speechSynthesis.speak(utterance); }
function calcDistance(lat1,lon1,lat2,lon2){ const R=6371; const dLat=(lat2-lat1)*Math.PI/180; const dLon=(lon2-lon1)*Math.PI/180; const a=Math.sin(dLat/2)**2+Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2; return R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)); }

const SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition;
let recognition=null;
if(SpeechRecognition){
  recognition=new SpeechRecognition();
  recognition.continuous=false;
  recognition.interimResults=false;
  document.getElementById("voice-btn").addEventListener("click", ()=>{
    recognition.lang=lang;
    recognition.start();
  });
  recognition.onresult=function(event){
    const speech=event.results[0][0].transcript.toLowerCase();
    let found=allPlaces.find(p=>(p.name||'').toLowerCase().includes(speech));
    if(found){ focusPlace(found.lat,found.lon,found.name,found.category); }
    else{ alert("Ø§Ù„Ù…ÙƒØ§Ù† ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©."); }
  };
} else { document.getElementById("voice-btn").disabled=true; }

document.getElementById("info-btn").addEventListener("click", ()=>{
  if(!lastSelectedPlace){ alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…ÙƒØ§Ù† Ø£ÙˆÙ„Ø§Ù‹ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø£Ùˆ Ø¹Ø¨Ø± Ø§Ù„ØªØ­Ø¯Ø«."); return; }
  let description=categoryDescriptions[lastSelectedPlace.category]||"ÙˆØµÙ ØºÙŠØ± Ù…ØªÙˆÙØ±.";
  document.getElementById("info-title").innerText=lastSelectedPlace.name;
  document.getElementById("info-desc").innerText=description;
  document.getElementById("info-popup").style.display="block";
});

loadPlaces(userLocation[0],userLocation[1]);

document.getElementById('search-input').addEventListener('input', function(){
  const query=this.value.toLowerCase();
  const listItems=document.querySelectorAll('#lists .list-item');
  listItems.forEach(item=>{ const name=item.querySelector('.item-name').innerText.toLowerCase(); item.style.display=name.includes(query)?"flex":"none"; });
  const detailsElems=document.querySelectorAll('#lists details');
  detailsElems.forEach(details=>{ const visibleItems=Array.from(details.querySelectorAll('.list-item')).some(it=>it.style.display!=='none'); details.style.display=visibleItems?"block":"none"; });
});

window.onload=()=>{ setTimeout(()=>{ const intro=document.getElementById('intro-screen'); if(intro) intro.style.display='none'; },3000); };
</script>
</body>
</html>
